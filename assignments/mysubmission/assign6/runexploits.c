/*
 * runexploits.c
 *
 * by Matthew Volk and CS107 staff
 *
 * Do NOT edit this file. This is just a lightweight main
 * that will call the code you write in the exploits.c file,
 * where you should make all your edits.
 *
 */


#include "database.h"
#include "exploits.h"

#include <error.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define DEFAULT_INIT_FILE "customdatabase.tsv"

static bool verify_level_one();


int main(int argc, char *argv[]) 
{
	printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
	printf("|                  Welcome to Wells Buggy!                  |\n");
	printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
	db_init(DEFAULT_INIT_FILE);

	/* Wells Buggy doesn't need any arguments */
	if (argc != 1)
		error(0, 0, "Ignoring excess arguments...");

	printf("Part One: Testing evil_send_payment...\n");
	printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
	evil_withdraw();
    verify_level_one();
        
	printf("\nPart Two: Testing evil_login...\n");
	printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
	evil_login();

	printf("\nPart Three: Testing evil_destroy_wells_buggy...\n");
	printf("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n");
	evil_destroy_wells_buggy();

	db_shutdown();
	printf("Thanks for using Wells Buggy! Please come again. :)\n");

	return 0;
}



/* Check that level one was passed successfully */
static bool verify_level_one() 
{
	char *cur_user = db_get_user();
	if (!cur_user || (strcmp(cur_user, "mvolk") != 0) || (db_check_balance() != 1000000)) {
		printf("Level one not passed. Try again!\n");
		free(cur_user);
		return false;
	}
	printf("\nLevel one passed! Matt is a millonaire!\n\n");
	free(cur_user);
	return true;
}




